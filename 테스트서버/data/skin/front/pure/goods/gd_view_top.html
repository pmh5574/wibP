<script type="text/javascript">
    <!--
    var bdGoodsQaId = '{bdGoodsQaId}';
    var bdGoodsReviewId = '{bdGoodsReviewId}';
    var goodsNo = '{goodsView.goodsNo}';
    var goodsViewController = new gd_goods_view();
    var goodsTotalCnt;
    var goodsOptionCnt = [];

    $(document).ready(function(){
        var parameters = {
            'setControllerName' : goodsViewController,
            'setOptionFl' : '{=goodsView["optionFl"]}',
            'setOptionTextFl'	: '{=goodsView["optionTextFl"]}',
            'setOptionDisplayFl'	: '{=goodsView["optionDisplayFl"]}',
            'setAddGoodsFl'	: '<!--{ ? is_array(goodsView["addGoods"]) }-->y<!--{ : }-->n<!--{ / }-->',
            'setIntDivision'	: '{=c.INT_DIVISION}',
            'setStrDivision'	: '{=c.STR_DIVISION}',
            'setMileageUseFl'	: '{=mileageData["useFl"]}',
            'setCouponUseFl'	: '{=couponUse}',
            'setMinOrderCnt'	: '{=goodsView["minOrderCnt"]}',
            'setMaxOrderCnt'	: '{=goodsView["maxOrderCnt"]}',
            'setStockFl'	: '{=gd_isset(goodsView["stockFl"])}',
            'setSalesUnit' : '{=gd_isset(goodsView["salesUnit"], 1)}',
            'setDecimal' : '{currency.decimal}',
            'setGoodsPrice' : '{=gd_isset(goodsView["goodsPrice"], 0)}',
            'setGoodsNo' : '{=goodsView["goodsNo"]}',
            'setMileageFl' : ' {=goodsView["mileageFl"]}',
            'setFixedSales' : '{=goodsView["fixedSales"]}',
            'setFixedOrderCnt' : '{=goodsView["fixedOrderCnt"]}',
            'setOptionPriceFl' : '{=optionPriceFl}',
            'setStockCnt' : '{=goodsView["stockCnt"]}'
    };

        goodsViewController.init(parameters);

        <!--{ ? goodsView['qrCodeFl'] == 'y' && goodsView['qrStyle'] == 'btn' }-->
        $('#qrCodeDownloadButton').on('click', function() {
            location.href = './goods_qr_code.php?goodsNo={=goodsView["goodsNo"]}&goodsName={=gd_htmlspecialchars_addslashes(goodsView["goodsNmDetail"])}';
        });
        <!--{ / }-->

        <!--{ ? goodsView['optionFl']== 'n' && goodsView['orderPossible'] == 'y' }-->
        goodsViewController.goods_calculate('#frmView', 1, 0, "{=gd_isset(goodsView['defaultGoodsCnt'])}");
        <!--{ / }-->

        /* 상품 이미지 슬라이드 */
        $('.item_photo_info_sec .slider_goods_nav').slick({
            dots: false,
            centerMode: false,
            slidesToShow: 5,
            slidesToScroll: 1,
            prevArrow: $('.item_photo_info_sec .slick_goods_prev'),
            nextArrow: $('.item_photo_info_sec .slick_goods_next')
        });

        /* 줌레이어 상품 이미지 슬라이드 */
        $('.ly_slider_goods_nav').slick({
            dots: false,
            centerMode: false,
            vertical: true,
            slidesToShow: 5,
            slidesToScroll: 1,
            prevArrow: $('.zoom_layer .slick_goods_prev'),
            nextArrow: $('.zoom_layer .slick_goods_next')
        });


        $('button.goods_cnt').on('click', function(e) {
            goodsViewController.count_change(this, 1);
        });

        $('button.add_goods_cnt').on('click', function(e) {
            goodsViewController.count_change(this);
        });


        <!--{ ? goodsView['benefitPossible'] == 'y' }-->
        gd_benefit_calculation();
        <!--{ / }-->

        <!--{ ? couponUse == 'y' }-->
        gd_open_layer();
        <!--{ / }-->

        <!--{ ? goodsView['imgDetailViewFl'] == 'y' }-->
        $("#mainImage img").data("image-zoom", $("#mainImage img").attr('src'));
//        $("#mainImage img").data("image-zoom", $("#testZoom img").attr('src'));
        $("#mainImage img").elevateZoom();
        <!--{ / }-->

        $('.btn_add_order').on('click', function(e){
            gd_goods_order('d');
            return false;
        });

        $('.btn_add_wish').on('click', function(e){
            gd_goods_order('w');
            return false;
        });

        $('.btn_add_cart').on('click', function(e){
            gd_goods_order();
            return false;
        });

        //상품 재입고 알림 팝업 오픈
        <!--{ ? goodsView['restockUsableFl'] === 'y' && !gGlobal.isFront }-->
        $('.restockSelector').on('click', function(e) {
            window.open("./popup_goods_restock.php?goodsNo="+goodsNo, "popupRestock", "top=100, left=200, status=0, width=682px, height=600px");
            return false;
        });
        <!--{ / }-->

        <!--{ ? goodsReviewAuthList == 'y'}-->
        gd_load_goodsBoardList(bdGoodsReviewId, goodsNo);
        <!--{ / }-->

        <!--{ ? goodsQaAuthList == 'y'}-->
        gd_load_goodsBoardList(bdGoodsQaId, goodsNo);
        <!--{ / }-->

        // SNS 공유하기
        $('.target_sns_share').on('click', function() {
            if ($("#lySns").css("display") == 'block') {
                // 단축주소 가져오기
                $.ajax({
                    type: 'post',
                    url: './goods_ps.php',
                    async: true,
                    cache: true,
                    data: {
                        mode: 'get_short_url',
                        url: '{=snsShareUrl}'
                    },
                    success: function (data) {
                        var json = $.parseJSON(data);
                        $('.sns_copy_url > input').val(json.url);
                        $('.sns_copy_url > button').attr('data-clipboard-text', json.url);
                    }
                });
            }
        });

        <!--{ ? goodsView['timeSaleFl'] }-->
        $("#displayTimeSale").hide();
        gd_dailyMissionTimer("{=goodsView['timeSaleInfo']['timeSaleDuration']}");
        <!--{ / }-->

        var canGoodsReview = '{canGoodsReview}';
        var canPlusReview = '{plusReviewConfig.isShowGoodsPage}';
        var canGoodsQa = '{canGoodsQa}';
        var tabCount = 5;
        if (!canGoodsReview && canPlusReview != 'y') {
            $('.tab a[href=#reviews]').remove();
            $('#reviews').hide();
            tabCount-- ;
        }

        if (!canGoodsQa) {
            $('.tab a[href=#qna]').remove();
            $('#qna').hide();
            tabCount--;
        }
        if (tabCount < 5) {
            $('.multiple-topics .tab a').css('width', 100 / tabCount + '%');
        }

        $('.layer-cartaddconfirm').click(function(){
            location.href = '../order/cart.php';
        });

        // 배송비 항목을 노출 안함 설정하면 배송비 타입을 생성
        var deliveryCollectFl = "{=goodsView['delivery']['basic']['collectFl']}";
        if ($('#frmView [name="deliveryCollectFl"]').length > 0) {
            // 이미 존재 패스
        } else if (deliveryCollectFl == 'both') {
            // 선택은 패스
        } else {
            $('#frmView').append('<input type="hidden" name="deliveryCollectFl" value="' + deliveryCollectFl + '">');
        }

        $('.btn_move_cart').click(function() {
            location.href = '../order/cart.php';
        });

        $('.btn_move_wish').click(function() {
            location.href = '../mypage/wish_list.php';
        });

        //배송 방식에 따른 방문 수령지 노출 여부
        $(".js-deliveryMethodFl").change(function(){
            if($(this).val() === 'visit'){
                $(".js-deliveryMethodVisitArea").removeClass('dn');
            }
            else {
                $(".js-deliveryMethodVisitArea").addClass('dn');
            }
        });
    });

    $(document).on('keydown focusout', 'input[name^=goodsCnt]', function(e){
        $(this).val($(this).val().replace(/[^0-9\-]/g,""));
    });

    /**
     * KC마크 인증정보창
     * @param string url KC인증번호검색 url
     * @return
     */
    function popupKcInfo(url) {
        var win = gd_popup({
            url: url
            , target: 'searchPop'
            , width: 750
            , height: 700
            , resizable: 'no'
            , scrollbars: 'yes'
        });
        win.focus();
        return win;
    }

    <!--{ ? couponUse == 'y' }-->
    // 쿠폰 오픈 레이어에 따른 분기
    function gd_open_layer() {
        $('.btn_open_layer').bind('click', function(e) {
            if ($(this).attr('href') == '#lyCouponDown') {
                gd_coupon_down();
            } else if ($(this).attr('href') == '#lyCouponApply') {
                gd_coupon_apply($(this).data('key'));
            }
        });
    }

    function gd_bind_coupon_cancel() {
        $('.btn_coupon_cancel').bind('click', function(e){
            $('.payco_pay').removeClass('dn');
            $('.naver_pay').removeClass('dn');
            gd_coupon_cancel($(this).data('key'), '');
        });
    }

    function gd_coupon_cancel(optionKey, typeCode) {
        $('#option_display_item_' + optionKey + ' input:hidden[name="couponApplyNo[]"]').val('');
        $('#option_display_item_' + optionKey + ' input:hidden[name="couponSalePriceSum[]"]').val('');
        $('#option_display_item_' + optionKey + ' input:hidden[name="couponAddPriceSum[]"]').val('');
        var couponApplyHtml = "<a href=\"#lyCouponApply\" class=\"btn_open_layer\" data-key=\""+optionKey+"\"><img src=\"../img/common/btn/btn_coupon_apply.png\" alt=\"{=__('쿠폰적용')}\"/></a>";
        $('#coupon_apply_' + optionKey).html(couponApplyHtml);
        if ($('#cart_tab_coupon_apply_'+optionKey).length) $('#cart_tab_coupon_apply_' + optionKey).html(couponApplyHtml);
        gd_open_layer();
        if (typeCode == 'noCalculation') {
            // 재계산 안함
        } else {
            gd_benefit_calculation();
        }
    }

    function gd_coupon_down() {
        $.ajax({
                method: "POST",
                cache: false,
                url: "../goods/layer_coupon_down.php",
                data: "goodsNo=" + {goodsView.goodsNo},
            success: function (data) {
            $('#lyCouponDown').empty().append(data);
            $('#lyCouponDown').find('>div').center();
        },
        error: function (data) {
            alert(data.message);
            gd_close_layer();
        }
    });
    }
    function gd_coupon_apply(optionKey) {
        var params = {
            mode: 'coupon_apply',
            goodsNo: {goodsView['goodsNo']},
            optionKey: optionKey,
            couponApplyNotNo: $('input:hidden[name="couponApplyNo[]"]').serializeArray(),
            couponApplyNo: $('#option_display_item_'+optionKey+' input:hidden[name="couponApplyNo[]"]').val(),
            goodsCnt: $('#option_display_item_'+optionKey+' input:text[name="goodsCnt[]"]').val(),
            goodsPriceSum: $('#option_display_item_'+optionKey+' input:hidden[name="goodsPriceSum[]"]').val(),
            optionPriceSum: $('#option_display_item_'+optionKey+' input:hidden[name="optionPriceSum[]"]').val(),
            optionTextPriceSum: $('#option_display_item_'+optionKey+' input:hidden[name="optionTextPriceSum[]"]').val(),
            addGoodsPriceSum: $('#option_display_item_'+optionKey+' input:hidden[name="addGoodsPriceSum[]"]').val(),
        };

        $.ajax({
            method: "POST",
            cache: false,
            url: "../goods/layer_coupon_apply.php",
            data: params,
            success: function (data) {
                $('#lyCouponApply').empty().append(data);
                $('#lyCouponApply').find('>div').center();
            },
            error: function (data) {
                alert(data.message);
                gd_close_layer();
            }
        });
    }
    <!--{ / }-->

    /**
     * 메인 이미지 변경
     *
     * @param string keyNo 상품 배열 키값
     */
    function gd_change_image(keyNo, type) {
        if (typeof keyNo == 'string') {
            var detailKeyID = new Array();
            <!--{ @ gd_isset(goodsView['image']['detail']['img']) }-->
            detailKeyID[{=.key_}] = "{=gd_htmlspecialchars_slashes(.value_, 'add')}";
            <!--{ / }-->

            var magnifyKeyID = new Array();
            <!--{ @ gd_isset(goodsView['image']['magnify']['img']) }-->
            magnifyKeyID[{=.key_}] = "{=gd_htmlspecialchars_slashes(.value_, 'add')}";
            <!--{ / }-->

            if (type == 'detail') {
                $('#mainImage').html(detailKeyID[keyNo]);
            } else {
                $('#magnifyImage').html(magnifyKeyID[keyNo]);
            }

            <!--{ ? goodsView['imgDetailViewFl'] == 'y' }-->
            $("#mainImage img").data("image-zoom", $("#mainImage img").attr('src'));
//            $("#mainImage img").data("image-zoom", $("#testZoom img").attr('src'));
            $("#mainImage img").elevateZoom();
            <!--{ / }-->
        }
    }

    /**
     * 총 합산
     */
    function gd_total_calculate() {
        var goodsPrice = parseFloat($('#frmView input[name="set_goods_price"]').val());

        //총합계 계산
        goodsTotalCnt =  0;
        $('#frmView input[name*="goodsCnt[]"]').each(function (index) {
            goodsTotalCnt += parseFloat($(this).val());
            goodsOptionCnt[index] = parseFloat($(this).val());
        });
        var goodsTotalPrice = goodsPrice * goodsTotalCnt;
        var setOptionPrice =  0;

        $('#frmView input[name*="optionPriceSum[]"]').each(function () {
            setOptionPrice += parseFloat($(this).val());
        });

        var setOptionTextPrice =  0;
        $('#frmView input[name*="optionTextPriceSum[]"]').each(function () {
            setOptionTextPrice += parseFloat($(this).val());
        });

        var setAddGoodsPrice =  0;
        $('#frmView input[name*="add_goods_total_price["]').each(function () {
            setAddGoodsPrice += parseFloat($(this).val());
        });

        $('#frmView input[name="set_option_price"]').val(setOptionPrice);
        $('#frmView input[name="set_option_text_price"]').val(setOptionTextPrice);
        $('#frmView input[name="set_add_goods_price"]').val(setAddGoodsPrice);

        var totalGoodsPrice = (goodsTotalPrice + setOptionPrice + setOptionTextPrice + setAddGoodsPrice).toFixed({currency.decimal});
        $('#frmView input[name="set_total_price"]').val(totalGoodsPrice);
        $(".goods_total_price").html("{=gd_global_currency_symbol()}" + gd_money_format(totalGoodsPrice) + "<b>{=gd_global_currency_string()}</b>");

        <!--{ ? addGlobalCurrency }-->
        $(".goods_total_price").append("<p class='add_currency'>{=gd_global_add_currency_symbol()} " + gd_add_money_format(totalGoodsPrice) + "{=gd_global_add_currency_string()}</p>");
        <!--{ / }-->

        gd_benefit_calculation();
    }

    /*
     * 혜택
     */
    function gd_benefit_calculation() {
        <!--{ ?  goodsView['goodsPriceDisplayFl'] =='n' }-->
        $('button.goods_cnt').attr('disabled', false);
        $('button.add_goods_cnt').attr('disabled', false);
        return false;
        <!--{ / }-->

        $('input[name="mode"]').val('get_benefit');
        var parameters = $("#frmView").serialize();

        if ($("#frmView input[name*='goodsNo']").length == 0) {
            parameters += "&goodsNo%5B%5D={goodsView['goodsNo']}&goodsCnt%5B%5D=1";
        }

        $.post('./goods_ps.php', parameters, function (data) {
            var getData = $.parseJSON(data);

            if(getData.totalDcPrice > 0 || getData.totalMileage > 0) {
                $(".item_discount_mileage").removeClass('dn');

                if(getData.totalDcPrice > 0 ) {
                    $(".item_discount_mileage span.item_discount").removeClass('dn');
                    $(".end_price dl.total_discount").removeClass('dn');
                    var tmp = new Array();
                    if (getData.goodsDcPrice) tmp.push("{=__('상품')} : " + " {=gd_global_currency_symbol()}" + gd_money_format(getData.goodsDcPrice) + "{=gd_global_currency_string()}");
                    if (getData.memberDcPrice) tmp.push("{=__('회원')} : " + " {=gd_global_currency_symbol()}" + gd_money_format(getData.memberDcPrice) + "{=gd_global_currency_string()}");
                    if (getData.couponDcPrice) tmp.push("{=__('쿠폰')} : " + " {=gd_global_currency_symbol()}" + gd_money_format(getData.couponDcPrice) + "{=gd_global_currency_string()}");

                    $(".benefit_price").html("(" + tmp.join() + ")");

                    $(".total_benefit_price").html("-{=gd_global_currency_symbol()}" + gd_money_format(getData.totalDcPrice) + "<b>{=gd_global_currency_string()}</b>");

                    <!--{ ? addGlobalCurrency }-->
                    $(".end_price .total_benefit_price").append("<p class='add_currency'>-{=gd_global_add_currency_symbol()} " + gd_add_money_format(getData.totalDcPrice) + "{=gd_global_add_currency_string()}</p>");
                    <!--{ / }-->

                    $("#set_dc_price").val(getData.totalDcPrice);

                } else {
                    $("#set_dc_price").val('0');
                    $(".item_discount_mileage span.item_discount").addClass('dn');
                    $(".end_price dl.total_discount").addClass('dn');
                }

                if(getData.totalMileage > 0 ) {
                    $(".item_discount_mileage span.item_mileage").removeClass('dn');
                    var tmp =new Array();
                    if (getData.goodsMileage) tmp.push("{=__('상품')} : " + gd_money_format(getData.goodsMileage) + "{=mileageData['unit']}");
                    if (getData.memberMileage) tmp.push("{=__('회원')} : " + gd_money_format(getData.memberMileage) + "{=mileageData['unit']}");
                    if (getData.couponMileage) tmp.push("{=__('쿠폰')} : " + gd_money_format(getData.couponMileage) + "{=mileageData['unit']}");
                    $(".benefit_mileage").html("("+tmp.join()+")");

                    $(".total_benefit_mileage").html("+" + gd_money_format(getData.totalMileage) + "{=mileageData['unit']}");
                } else {
                    $(".item_discount_mileage span.item_mileage").addClass('dn');
                }
            } else {
                $("#set_dc_price").val('0');
                $(".item_discount_mileage").addClass('dn');
                $(".end_price dl.total_discount").addClass('dn');
            }

            if ($('#frmView input[name="set_total_price"]').val().trim() == '0') {
                $(".total_price").html("{=gd_global_currency_symbol()}0<b>{=gd_global_currency_string()}</b>");
                <!--{ ? addGlobalCurrency }-->
                $(".total_price").append("<p class='add_currency'>{=gd_global_add_currency_symbol()} " + 0 + "{=gd_global_add_currency_string()}</p>");
                <!--{ / }-->
                if ($("#cart_tab_option").length) $("#cart_tab_option .total_benefit_price").html("{=gd_global_currency_symbol()}0<b>{=gd_global_currency_string()}</b>");

            } else {
                var totalPrice = parseFloat($('#frmView input[name="set_total_price"]').val()) - parseFloat(getData.totalDcPrice);
                $(".total_price").html(" {=gd_global_currency_symbol()} " + gd_money_format(totalPrice) + "<b>{=gd_global_currency_string()}</b>");

                <!--{ ? addGlobalCurrency }-->
                $(".total_price").append("<p class='add_currency'>{=gd_global_add_currency_symbol()} " + gd_add_money_format(totalPrice) + "{=gd_global_add_currency_string()}</p>");
                <!--{ / }-->
            }

            $('button.goods_cnt').attr('disabled', false);
            $('button.add_goods_cnt').attr('disabled', false);
            // 쿠폰 구매금액 제한에 따른 처리
            if (typeof getData.couponAlertKey == 'undefined') {
                // 구매 금액 제한에 걸리지 않음
            } else {
                gd_coupon_cancel(getData.couponAlertKey, 'noCalculation');
                alert("{=__('적용 쿠폰이 구매 금액 제한에 걸려 적용 쿠폰이 취소 되었습니다.')}");
            }
        });
    }

    /**
     * 바로구매, 장바구니, 상품 보관함
     *
     * @param string modeStr 처리 모드
     */
    var salesUnit = parseInt("{=gd_isset(goodsView['salesUnit'],1)}");
    var minOrderCnt = parseInt("{=gd_isset(goodsView['minOrderCnt'],1)}");
    var maxOrderCnt = parseInt("{=gd_isset(goodsView['maxOrderCnt'],0)}");
    function gd_goods_order(modeStr)
    {
        {customScript}
        $('#frmView input[name=\'cartMode\']').val(modeStr);

        if (modeStr == 'w') {
            <!--{ ? gd_is_login() === false }-->
            alert("{=__('로그인하셔야 본 서비스를 이용하실 수 있습니다.')}");
            document.location.href = "../member/login.php";
            return false;
            <!--{ : }-->

            var goodsNoCnt = $('#frmView input[name*="goodsNo[]"]').length;
            if(goodsNoCnt == 0) {
                $('#frmView input[name="cartMode"]').val('{=goodsView["goodsNo"]}');
            }

            $('#frmView input[name="mode"]').val('wishIn');
            $('#frmView').attr('action','../mypage/wish_list_ps.php');
            <!--{ / }-->
        } else {
            $('#frmView input[name="mode"]').val('cartIn');
            $('#frmView').attr('action','../order/cart_ps.php');

            <!--{ ? goodsView['optionFl'] == 'y'}-->
            var goodsInfo = $('#frmView input[name*=\'optionSno[]\']').length;
            <!--{ : }-->
            var goodsInfo = $('#frmView input[name="optionSnoInput"]').val();
            <!--{ / }-->

            if (goodsInfo == '') {
                alert("{=__('가격 정보가 없거나 옵션이 선택되지 않았습니다!')}");
                return false;
            }

            <!--{ ? gd_isset(goodsView['optionTextFl']) == 'y' }-->
            if(!goodsViewController.option_text_valid("#frmView")) {
                alert("{=__('입력 옵션을 확인해주세요.')}");
                return false;
            }
                <!--{ ? gd_isset(goodsView['stockFl']) == 'y' }-->
                var checkOptionCnt = goodsViewController.option_text_cnt_valid("#frmView");
                if(checkOptionCnt) {
                    alert(__('재고가 부족합니다. 현재 %s개의 재고가 남아 있습니다.', checkOptionCnt));
                    return false;
                }
                <!--{ / }-->
            <!--{ / }-->

            <!--{ ? goodsView['addGoods'] }-->
            //추가상품
            if(!goodsViewController.add_goods_valid("#frmView")) {
                alert("{=__('필수 추가 상품을 확인해주세요.')}");
                return false;
            }
            <!--{ / }-->

        }

        var submitFl = true;
        if (isNaN(goodsTotalCnt)) goodsTotalCnt = 1;
        if (_.isEmpty(goodsOptionCnt)) goodsOptionCnt[0] = 1;
        <!--{ ? goodsView['fixedSales'] == 'goods' }-->
        var perSalesCnt = goodsTotalCnt % salesUnit;

        if (perSalesCnt !== 0) {
            alert(__('%s개 단위로 묶음 주문 상품입니다.', salesUnit));
            submitFl = false;
        }
        <!--{ : }-->
        for (i in goodsOptionCnt) {
            if (isNaN(goodsOptionCnt[i])) goodsOptionCnt[i] = 0;
            var perSalesCnt = goodsOptionCnt[i] % salesUnit;

            if (perSalesCnt !== 0) {
                alert(__('%s개 단위로 묶음 주문 상품입니다.', salesUnit));
                submitFl = false;
                break;
            }
        }
        <!--{ / }-->

        if (submitFl == true) {
            <!--{ ? goodsView['fixedOrderCnt'] == 'goods'}-->
            var fixedAlertString = '상품당';
            <!--{ / }-->
            <!--{ ? goodsView['fixedOrderCnt'] == 'option'}-->
            var fixedAlertString = '옵션당';
            <!--{ / }-->
            <!--{ ? goodsView['fixedOrderCnt'] == 'id' }-->
            var fixedAlertString = 'ID당';
            <!--{ / }-->

            <!--{ ? goodsView['fixedOrderCnt'] == 'goods' || goodsView['fixedOrderCnt'] == 'id' }-->
            <!--{ ? goodsView['fixedOrderCnt'] == 'goods'}-->
            if (minOrderCnt > 1 && goodsTotalCnt < minOrderCnt) {
                alert(__('최소 구매 수량 미달 : ' + fixedAlertString + ' 최소 %s개 이상 구매가능합니다.', minOrderCnt));
                submitFl = false;
            } else if (maxOrderCnt > 0 && goodsTotalCnt > maxOrderCnt) {
                alert(__('최대 구매 수량 초과 : ' + fixedAlertString + ' 최대 %s개 이하 구매가능합니다.', maxOrderCnt));
                submitFl = false;
            }
            <!--{ / }-->
            <!--{ ? goodsView['fixedOrderCnt'] == 'id' }-->
            //ajax로 id구매카운트 체크
            var params = {
                mode: 'check_memberOrderGoodsCount',
                goodsNo: {=goodsView['goodsNo']},
            };
            $.ajax({
                method: "POST",
                async: false,
                cache: false,
                url: '../order/order_ps.php',
                data: params,
                success: function (data) {
                    // error 메시지 예외 처리용
                    if (!_.isUndefined(data.error) && data.error == 1) {
                        alert(data.message);
                        return false;
                    }

                    if (minOrderCnt > 1 && (goodsTotalCnt + data.count) < minOrderCnt) {
                        alert(__('최소 구매 수량 미달 : ' + fixedAlertString + ' 최소 %s개 이상 구매가능합니다.', minOrderCnt));
                        submitFl = false;
                    } else if (minOrderCnt > 1 && goodsTotalCnt < minOrderCnt) {
                        alert(__('최소 구매 수량 미달 : ' + fixedAlertString + ' 최소 %s개 이상 구매가능합니다.', minOrderCnt));
                        submitFl = false;
                    } else if (maxOrderCnt > 0 && (goodsTotalCnt + data.count) > maxOrderCnt) {
                        alert(__('최대 구매 수량 초과 : ' + fixedAlertString + ' 최대 %s개 이하 구매가능합니다.', maxOrderCnt));
                        submitFl = false;
                    } else if (maxOrderCnt > 0 && goodsTotalCnt > maxOrderCnt) {
                        alert(__('최대 구매 수량 초과 : ' + fixedAlertString + ' 최대 %s개 이하 구매가능합니다.', maxOrderCnt));
                        submitFl = false;
                    }
                },
                error: function (data) {
                    alert(data.message);
                    submitFl = false;
                }
            });
            <!--{ / }-->
            <!--{ : }-->
            for (i in goodsOptionCnt) {
                if (isNaN(goodsOptionCnt[i])) goodsOptionCnt[i] = 0;
                var perSalesCnt = goodsOptionCnt[i] % salesUnit;

                if (minOrderCnt > 1 && goodsOptionCnt[i] < minOrderCnt) {
                    alert(__('최소 구매 수량 미달 : ' + fixedAlertString + ' 최소 %s개 이상 구매가능합니다.', minOrderCnt));
                    submitFl = false;
                    break;
                } else if (maxOrderCnt > 0 && goodsOptionCnt[i] > maxOrderCnt) {
                    alert(__('최대 구매 수량 초과 : ' + fixedAlertString + ' 최대 %s개 이하 구매가능합니다.', maxOrderCnt));
                    submitFl = false;
                    break;
                }
            }
            <!--{ / }-->
        }

        if ((modeStr == 'd' || modeStr == 'pa') && submitFl === false) {
            return false;
        }

        if(modeStr == 'pa') {
            return true;
        }

        $('#frmView').attr('target','');

        // 쿠폰 사용기간 체크
        if ($('input:hidden[name="couponApplyNo[]"]').val()) {
            var checkCouponType = true;
            var couponApplyNo;
            $.ajax({
                method: "POST",
                cache: false,
                async: false,
                url: "../goods/goods_ps.php",
                data: {mode: 'goodsCheckCouponTypeArr', couponNo : $('input:hidden[name="couponApplyNo[]"]').val() },
                success: function (data) {
                    checkCouponType = data.isSuccess;
                    couponApplyNo = data.setCouponApplyNo.join('{c.INT_DIVISION}');
                },
                error: function (e) {
                }
            });

            if(!checkCouponType) {
                $('input:hidden[name="couponApplyNo[]"]').val(couponApplyNo);
                alert('사용기간이 만료된 쿠폰이 포함되어 있어 제외 후 진행합니다.');
            }
        }

        if (modeStr == 'w' || typeof modeStr == 'undefined') {
            var params = $("#frmView").serialize();

            if (modeStr == 'w') {
                var ajaxUrl = '../mypage/wish_list_ps.php';
                var target = $("#addWishLayer");
            } else {
                var ajaxUrl = '../order/cart_ps.php';
                var target = $("#addCartLayer");
            }

            $.ajax({
                method: "POST",
                cache: false,
                url: ajaxUrl,
                data: params,
                success: function (data) {
                    // error 메시지 예외 처리용
                    if (!_.isUndefined(data.error) && data.error == 1) {
                        alert(data.message);
                        return false;
                    }

                    <!--{ ? cartInfo.wishPageMoveDirectFl == 'y' || (cartInfo.wishPageMoveDirectFl == 'n' && cartInfo.moveWishPageDeviceFl == 'mobile') }-->
                    if (modeStr == 'w') {
                        location.href = "../mypage/wish_list.php";
                        return false;
                    }
                    <!--{ / }-->
                    <!--{ ? cartInfo.moveCartPageFl == 'y' || (cartInfo.moveCartPageFl == 'n' && cartInfo.moveCartPageDeviceFl == 'mobile') }-->
                    if (typeof modeStr == 'undefined') {
                        location.href = "../order/cart.php";
                        return false;
                    }
                    <!--{ / }-->
                    target.removeClass('dn');
                    $('#layerDim').removeClass('dn');
                    target.find('> div').center();
                },
                error: function (data) {
                    alert(data.message);
                }
            });
        } else {
            $('#frmView').submit();
        }
    }

    <!--{ ?goodsView['optionImagePreviewFl'] == 'y' }-->

    /**
     * 옵션 선택시 상세 이미지 변경
     *
     * @param integer optionNo 상품 배열 키값 (기본 0)
     */
    function gd_option_image_apply() {
        <!--{ ? goodsView['optionDisplayFl'] == 's' }-->
        var optionImgSrc = $('select[name="optionSnoInput"] option:selected').data('img-src');
        <!--{ : goodsView['optionDisplayFl'] == 'd' }-->
        var optionImgSrc = $('select[name="optionNo_0"] option:selected').data('img-src');
        <!--{ / }-->

        if(optionImgSrc && optionImgSrc !='blank') $("#mainImage img").attr("src",optionImgSrc);
    }
    <!--{ / }-->

    <!--{ ? goodsView['timeSaleFl'] }-->
    /**
     * 시간간격 카운트
     * @returns {String}
     */
    function gd_dailyMissionTimer(duration) {

        var timer = duration;
        var days, hours, minutes, seconds;

        var interval = setInterval(function(){
            days	= parseInt(timer / 86400, 10);
            hours	= parseInt(((timer % 86400 ) / 3600), 10);
            minutes = parseInt(((timer % 3600 ) / 60), 10);
            seconds = parseInt(timer % 60, 10);

            if(days == 0) {
                $('.time_day_view').hide();
            } else {
                days = days < 10 ? "0" + days : days;
                $('#displayTimeSaleDay').text(days);
            }

            hours 	= hours < 10 ? "0" + hours : hours;
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            $('#displayTimeSaleTime').text(hours + " : " + minutes + " : " + seconds);

            $("#displayTimeSale").show();

            if (--timer < 0) {
                timer = 0;
                clearInterval(interval);
            }
        }, 1000);
    }
    <!--{ / }-->


    //2020-01-01 옵션선택 박스 시작
    function selectColorchip(name, idx, thisIdx, nextOptName, optionStock) {
        $("select[name='" + name + "'] option").removeProp("selected");
        $("select[name='" + name + "'] option").eq(idx+1).prop("selected","selected");
        goodsViewController.option_select($("select[name='"+ name +"']"), thisIdx, nextOptName, optionStock);
    }

    //2020-01-01 옵션선택 박스
    // 선택된 컬러칩의 border컬러 지정
    /*
    function setSelectColor(item, idx) {
        $(item).siblings('div').css('border', '1px solid #999');
        $(item).css('border', '1px solid red');
    }
    */

    $(document).ready(function() {
        //2020-01-01 옵션선택 박스
        $(".size-select").on("chosen:updated", function(e) {

            var name = $(this).attr('name');
            var optionIndex = $(this).attr('data-index');
            var nextOptName = $(this).attr('data-nextOptionName');
            var optionStock = $(this).attr('data-optionStock');

            $(this).find("option").each(function (idx, item) {
                if($(item).val() == '') return;

                if($(item).attr('disabled') !== undefined) {
                    $('#size-wrapper-' + optionIndex).find('div').eq((idx-1)).addClass('size-block-soldout');
                    var onclick = $('#size-wrapper-' + optionIndex).find('div').eq((idx-1)).attr('onclick');
                    if(onclick.indexOf('selectColorchip') > -1) {
                        $('#size-wrapper-' + optionIndex).find('div').eq((idx-1)).attr('bak-onclick', onclick);
                    }
                    $('#size-wrapper-' + optionIndex).find('div').eq((idx-1)).attr('onclick', 'alert("품절되었습니다.")');
                } else {
                    $('#size-wrapper-' + optionIndex).find('div').eq((idx-1)).removeClass('size-block-soldout');
                    var bakOnclick = $('#size-wrapper-' + optionIndex).find('div').eq((idx-1)).attr('bak-onclick');
                    if(bakOnclick !== undefined && bakOnclick != '') {
                        $('#size-wrapper-' + optionIndex).find('div').eq((idx-1)).attr('onclick', bakOnclick);
                        $('#size-wrapper-' + optionIndex).find('div').eq((idx-1)).removeAttr('bak-onclick');
                    }
                }

                if($(item).is(":selected")) {
                    $('#size-wrapper-' + optionIndex).find('div').eq((idx-1)).addClass('select');
                } else {
                    $('#size-wrapper-' + optionIndex).find('div').eq((idx-1)).removeClass('select');

                }

            });
        });

        //2020-01-01 옵션선택 박스
        $(".color-select").on("chosen:updated", function(e) {

            var name = $(this).attr('name');
            var optionIndex = $(this).attr('data-index');
            var nextOptName = $(this).attr('data-nextOptionName');
            var optionStock = $(this).attr('data-optionStock');

            $(this).find("option").each(function(idx, item) {
                if($(item).val() == '') return;

                if($(item).attr('disabled') !== undefined) {
                    $('#color-wrapper-' + optionIndex).find('div').eq((idx-1)).addClass('size-block-soldout');
                } else {
                    $('#color-wrapper-' + optionIndex).find('div').eq((idx-1)).removeClass('size-block-soldout');
                }

                if($(item).is(":selected")) {
                    $('#color-wrapper-' + optionIndex).find('div.color-block-wrap').eq((idx-1)).addClass('select');
                } else {
                    $('#color-wrapper-' + optionIndex).find('div.color-block-wrap').eq((idx-1)).removeClass('select');

                }


            });
        });
    });
    //2020-01-01 옵션선택 박스 끝
    //-->
</script>
<script type="text/html" id="optionTemplate">
    <tbody id="option_display_item_<%=displayOptionkey%>">
    <tr class="check optionKey_<%=optionSno%>">
        <td class="cart_prdt_name">
            <input type="hidden" name="goodsNo[]" value="{=goodsView['goodsNo']}" />
            <input type="hidden" name="optionSno[]" value="<%=optionSno%>" />
            <input type="hidden" name="goodsPriceSum[]" value="0" />
            <input type="hidden" name="addGoodsPriceSum[]" value="0" />
            <input type="hidden" name="displayOptionkey[]" value="<%=displayOptionkey%>" />
            <!--{ ? couponUse == 'y' }-->
            <input type="hidden" name="couponApplyNo[]" value="" />
            <input type="hidden" name="couponSalePriceSum[]" value="" />
            <input type="hidden" name="couponAddPriceSum[]" value="" />
            <!--{ / }-->
            <div class="cart_tit_box">
                <strong class="cart_tit">
                    <span><%=optionName%></span>
                    <span><%=optionSellCodeValue%><%=optionDeliveryCodeValue%></span>
                    <!--{ ? couponUse == 'y' && couponConfig['chooseCouponMemberUseType'] != 'member' }-->
                    <span class="cart_btn_box">
                            <!--{ ? gd_is_login() === false }-->
                            <button type="button" class="btn_alert_login"><img src="../img/common/btn/btn_coupon_apply.png" alt="{=__('쿠폰적용')}"/></button>
                        <!--{ : }-->
                            <a href="#lyCouponApply" id="coupon_apply_<%=displayOptionkey%>" class="btn_open_layer" data-key="<%=displayOptionkey%>">
                                <img src="../img/common/btn/btn_coupon_apply.png" alt="{=__('쿠폰적용')}"/>
                            </a>
                        <!--{ / }-->
                        </span>
                    <!--{ / }-->
                    <span id="option_text_display_<%=displayOptionkey%>"></span>
                </strong>
            </div>
        </td>
        <td>
                <span class="count">
                    <span class="goods_qty">
                        <input type="text" class="text goodsCnt_<%=displayOptionkey%>" title="{=__('수량')}" name="goodsCnt[]" value="{=gd_isset(goodsView['defaultGoodsCnt'])}" data-value="{=gd_isset(goodsView['defaultGoodsCnt'])}" data-stock="<%=optionStock%>" data-key="<%=displayOptionkey%>" onchange="goodsViewController.input_count_change(this, '1');return false;" />
                        <span>
                            <button type="button" class="up goods_cnt" title="{=__('증가')}"  value="up{=c.STR_DIVISION}<%=displayOptionkey%>">{=__('증가')}</button>
                            <button type="button" class="down goods_cnt" title="{=__('감소')}"  value="dn{=c.STR_DIVISION}<%=displayOptionkey%>">{=__('감소')}</button>
                        </span>
                    </span>
                </span>
        </td>
        <td class="item_choice_price">
            <input type="hidden" name="option_price_<%=displayOptionkey%>" value="<%=optionPrice%>" />
            <input type="hidden" name="optionPriceSum[]" value="0" />
            {=gd_global_currency_symbol()}<strong class="option_price_display_<%=displayOptionkey%>"><%=optionPrice%></strong>{=gd_global_currency_string()}
        </td>
        <td>
            <button type="button" class="delete_goods" data-key="option_display_item_<%=displayOptionkey%>"><img src="../img/icon/shop_cart/ico_cart_del.png" alt="{=__('삭제')}"/></button>
        </td>
    </tr>
    </tbody>
</script>
<script type="text/html" id="addGoodsTemplate">
    <tr id="add_goods_display_item_<%=displayOptionkey%>_<%=displayAddGoodsKey%>" class="check item_choice_divide">
        <td class="cart_prdt_name">
            <div class="cart_tit_box">
                <input type="hidden" name="addGoodsNo[<%=optionIndex%>][]" value="<%=optionSno%>" data-group="<%=addGoodsGroup%>" />
                <strong class="item_choice_tit">
                    <em class="item_choice_photo"><%=addGoodsimge%></em><span><%=addGoodsName%></span>
                </strong>
            </div>
        </td>
        <td>
            <span class="count">
                <span class="goods_qty">
                    <input type="text" name="addGoodsCnt[<%=optionIndex%>][]" class="text addGoodsCnt_<%=displayOptionkey%>_<%=displayAddGoodsKey%>" title="{=__('수량')}" value="1"  data-key="<%=displayOptionkey%>{=c.INT_DIVISION}<%=displayAddGoodsKey%>"  data-value="1" data-stock-fl="<%=addGoodsStockFl%>"  data-stock="<%=addGoodsStock%>" onchange="goodsViewController.input_count_change(this);return false;">
                    <span>
                        <button type="button" class="up add_goods_cnt" title="{=__('증가')}"  value="up{=c.STR_DIVISION}<%=displayOptionkey%>{=c.INT_DIVISION}<%=displayAddGoodsKey%>">{=__('증가')}</button>
                        <button type="button" class="down add_goods_cnt" title="{=__('감소')}" value="dn{=c.STR_DIVISION}<%=displayOptionkey%>{=c.INT_DIVISION}<%=displayAddGoodsKey%>">{=__('감소')}</button>
                    </span>
                </span>
            </span>
        </td>
        <td class="item_choice_price">
            <input type="hidden" name="add_goods_price_<%=displayOptionkey%>_<%=displayAddGoodsKey%>" value="<%=addGoodsPrice%>" />
            <input type="hidden" name="add_goods_total_price[<%=optionIndex%>][]" value="" />
            {=gd_global_currency_symbol()}<strong class="add_goods_price_display_<%=displayOptionkey%>_<%=displayAddGoodsKey%>"></strong>{=gd_global_currency_string()}
        </td>
        <td>
            <button type="button" class="delete_add_goods" data-key="<%=displayOptionkey%>-<%=displayAddGoodsKey%>"><img src="../img/icon/shop_cart/ico_cart_del.png" alt="{=__('삭제')}"/></button>
        </td>
    </tr>
</script>